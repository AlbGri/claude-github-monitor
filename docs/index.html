<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code GitHub Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #1a1a1a;
            line-height: 1.6;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 2.5rem 1.5rem;
        }
        h1 {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .subtitle {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 1.75rem;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }
        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        .stat-label {
            font-size: 0.7rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-top: 0.15rem;
        }
        .stat-date { color: #6b7280; }
        .stat-commits { color: #6b7280; }
        .stat-pct { color: #ea580c; }
        .chart-container {
            background: #fff;
            border-radius: 12px;
            padding: 1.25rem 1.25rem 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        footer {
            margin-top: 1.5rem;
            text-align: center;
            color: #9ca3af;
            font-size: 0.8rem;
        }
        footer a { color: #6b7280; text-decoration: none; }
        footer a:hover { text-decoration: underline; }
        .loading {
            text-align: center;
            padding: 4rem;
            color: #9ca3af;
        }
        @media (max-width: 600px) {
            .container { padding: 1.5rem 1rem; }
            .stats { grid-template-columns: 1fr; }
            .stat-card { padding: 0.75rem 1rem; }
            h1 { font-size: 1.3rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Claude Code GitHub Tracker</h1>
        <p class="subtitle">Tracking Claude Code adoption across public GitHub commits</p>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Latest date</div>
                <div class="stat-value stat-date" id="stat-date">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Commits</div>
                <div class="stat-value stat-commits" id="stat-commits">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Adoption Rate</div>
                <div class="stat-value stat-pct" id="stat-pct">--</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="loading" id="loading">Loading data...</div>
            <canvas id="chart" style="display:none"></canvas>
        </div>

        <footer>
            Source: <a href="https://github.com/AlbGri/claude-github-monitor">AlbGri/claude-github-monitor</a>
            &middot; Updated daily via GitHub Actions
        </footer>
    </div>

    <script>
        const CSV_URL = 'https://raw.githubusercontent.com/AlbGri/claude-github-monitor/main/data/claude_commits_daily.csv';

        async function loadData() {
            const resp = await fetch(CSV_URL);
            const text = await resp.text();
            return text.trim().split('\n').slice(1)
                .map(line => {
                    const [date, cc, tc] = line.split(',');
                    const claude = parseInt(cc, 10);
                    const total = parseInt(tc, 10);
                    return { date, claude, total, pct: total > 0 ? claude / total * 100 : 0 };
                })
                .filter(d => d.claude > 0);
        }

        function fmtK(v) {
            return Math.round(v / 1000) + 'K';
        }

        function renderStats(data) {
            const d = data[data.length - 1];
            document.getElementById('stat-date').textContent = d.date;
            document.getElementById('stat-commits').textContent = (d.total / 1000000).toFixed(1) + 'M';
            document.getElementById('stat-pct').textContent = d.pct.toFixed(1) + '%';
        }

        function renderChart(data) {
            document.getElementById('loading').style.display = 'none';
            const canvas = document.getElementById('chart');
            canvas.style.display = 'block';

            const showPoints = data.length <= 90;

            new Chart(canvas, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [
                        {
                            label: 'Total Commits',
                            data: data.map(d => d.total),
                            borderColor: '#6b7280',
                            backgroundColor: 'rgba(107, 114, 128, 0.06)',
                            fill: true,
                            yAxisID: 'y',
                            tension: 0.3,
                            pointRadius: showPoints ? 2.5 : 0,
                            pointHoverRadius: 4,
                            borderWidth: 1.5,
                        },
                        {
                            label: 'Claude Code Adoption',
                            data: data.map(d => d.pct),
                            borderColor: '#ea580c',
                            backgroundColor: 'transparent',
                            fill: false,
                            yAxisID: 'y1',
                            tension: 0.3,
                            pointRadius: showPoints ? 2.5 : 0,
                            pointHoverRadius: 4,
                            borderWidth: 2.5,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.2,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: data.length > 180 ? 'month' : 'week',
                                displayFormats: { week: 'MMM d', month: 'MMM yyyy' },
                                tooltipFormat: 'MMM d, yyyy',
                            },
                            grid: { display: false },
                            ticks: { color: '#9ca3af', font: { size: 11 } },
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Total Commits',
                                color: '#6b7280',
                                font: { size: 12, weight: '600' },
                            },
                            ticks: {
                                callback: v => (v / 1000000).toFixed(1) + 'M',
                                color: '#6b7280',
                                font: { size: 11 },
                            },
                            grid: { color: 'rgba(0,0,0,0.04)' },
                            beginAtZero: false,
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Claude Code Adoption',
                                color: '#ea580c',
                                font: { size: 12, weight: '600' },
                            },
                            ticks: {
                                callback: v => v.toFixed(1) + '%',
                                color: '#ea580c',
                                font: { size: 11 },
                            },
                            grid: { display: false },
                            beginAtZero: false,
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleFont: { size: 12 },
                            bodyFont: { size: 12 },
                            padding: 10,
                            cornerRadius: 6,
                            callbacks: {
                                label: function(ctx) {
                                    if (ctx.datasetIndex === 0) {
                                        return 'Total Commits: ' + ctx.raw.toLocaleString();
                                    }
                                    return 'Claude Code Adoption: ' + ctx.raw.toFixed(1) + '%';
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            align: 'end',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'line',
                                padding: 16,
                                font: { size: 12 },
                            }
                        }
                    }
                }
            });
        }

        loadData()
            .then(data => { renderStats(data); renderChart(data); })
            .catch(err => {
                document.getElementById('loading').textContent = 'Error loading data.';
            });
    </script>
</body>
</html>
