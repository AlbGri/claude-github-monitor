<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code GitHub Tracker</title>
    <meta name="description" content="Daily tracking of Claude Code adoption across public GitHub commits. Interactive chart with adoption rate trends.">

    <!-- Open Graph for LinkedIn / social sharing -->
    <meta property="og:title" content="Claude Code GitHub Tracker">
    <meta property="og:description" content="Daily tracking of Claude Code adoption across public GitHub commits.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://albgri.github.io/claude-github-monitor/">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'none';
        script-src 'self' 'unsafe-inline';
        style-src 'unsafe-inline';
        connect-src https://raw.githubusercontent.com;
        img-src 'self' data:;
        base-uri 'self'
    ">

    <!-- Performance: preconnect for CSV fetch -->
    <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>

    <script src="vendor/chart.umd.min.js" defer></script>
    <script src="vendor/chartjs-adapter-date-fns.bundle.min.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #1a1a1a;
            line-height: 1.6;
        }
        .skip-link {
            position: absolute;
            top: -100%;
            left: 0.5rem;
            padding: 0.5rem 1rem;
            background: #1a1a1a;
            color: #fff;
            border-radius: 0 0 6px 6px;
            z-index: 100;
            text-decoration: none;
        }
        .skip-link:focus {
            top: 0;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 2.5rem 1.5rem;
        }
        h1 {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .subtitle {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 1.75rem;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }
        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        .stat-label {
            font-size: 0.7rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-top: 0.15rem;
        }
        .stat-date { color: #6b7280; }
        .stat-commits { color: #6b7280; }
        .stat-pct { color: #ea580c; }
        .chart-container {
            position: relative;
            background: #fff;
            border-radius: 12px;
            padding: 1.25rem 1.25rem 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        .fullscreen-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(0,0,0,0.05);
            border: none;
            border-radius: 6px;
            padding: 0.35rem 0.5rem;
            cursor: pointer;
            color: #6b7280;
            font-size: 0.75rem;
            z-index: 10;
            line-height: 1;
        }
        .fullscreen-btn:hover { background: rgba(0,0,0,0.1); }
        .chart-container:fullscreen,
        .chart-container:-webkit-full-screen {
            background: #fff;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .chart-container:fullscreen canvas,
        .chart-container:-webkit-full-screen canvas {
            max-height: 90vh;
        }
        footer {
            margin-top: 1.5rem;
            text-align: center;
            color: #9ca3af;
            font-size: 0.8rem;
        }
        footer a { color: #6b7280; text-decoration: none; }
        footer a:hover { text-decoration: underline; }
        .loading {
            text-align: center;
            padding: 4rem;
            color: #9ca3af;
        }
        @media (max-width: 600px) {
            .container { padding: 1.5rem 1rem; }
            .stats { grid-template-columns: 1fr; }
            .stat-card { padding: 0.75rem 1rem; }
            h1 { font-size: 1.3rem; }
            .chart-container canvas { min-height: 260px; }
        }
        @media (prefers-reduced-motion: reduce) {
            * { transition: none !important; }
        }
    </style>
</head>
<body>
    <!-- Skip link for keyboard navigation (WCAG 2.1) -->
    <a href="#chart-section" class="skip-link">Skip to chart</a>

    <div class="container">
        <header>
            <h1>Claude Code GitHub Tracker</h1>
            <p class="subtitle">Tracking Claude Code adoption across public GitHub commits</p>
        </header>

        <section class="stats" aria-label="Summary statistics" role="region">
            <div class="stat-card">
                <div class="stat-label" id="label-date">Latest date</div>
                <div class="stat-value stat-date" id="stat-date" aria-labelledby="label-date">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label" id="label-commits">Total Commits (7d avg)</div>
                <div class="stat-value stat-commits" id="stat-commits" aria-labelledby="label-commits" aria-live="polite">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label" id="label-pct">Adoption Rate (7d avg)</div>
                <div class="stat-value stat-pct" id="stat-pct" aria-labelledby="label-pct" aria-live="polite">--</div>
            </div>
        </section>

        <main id="chart-section" class="chart-container" tabindex="-1">
            <button class="fullscreen-btn" id="fullscreen-btn" aria-label="Toggle fullscreen" title="Fullscreen">&#x26F6;</button>
            <div class="loading" id="loading" role="status" aria-live="polite">Loading data...</div>
            <canvas id="chart" style="display:none" role="img" aria-label="Chart showing daily GitHub total commits and Claude Code adoption rate over time"></canvas>
        </main>

        <footer role="contentinfo">
            Source: <a href="https://github.com/AlbGri/claude-github-monitor">AlbGri/claude-github-monitor</a>
            &middot; Updated daily via GitHub Actions
        </footer>
    </div>

    <script>
        const CSV_URL = 'https://raw.githubusercontent.com/AlbGri/claude-github-monitor/main/data/claude_commits_daily.csv';
        const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        const RELEASES = [
            { date: '2025-02-24', label: '3.7 Sonnet',  color: 'rgba(59, 130, 246, 0.07)' },
            { date: '2025-05-22', label: 'Opus 4',      color: 'rgba(34, 197, 94, 0.07)' },
            { date: '2025-08-05', label: 'Opus 4.1',    color: 'rgba(168, 85, 247, 0.07)' },
            { date: '2025-09-29', label: 'Sonnet 4.5',  color: 'rgba(234, 179, 8, 0.07)' },
            { date: '2025-10-20', label: 'Code Web',    color: 'rgba(20, 184, 166, 0.07)' },
            { date: '2025-11-24', label: 'Opus 4.5',    color: 'rgba(244, 63, 94, 0.07)' },
            { date: '2026-02-05', label: 'Opus 4.6',    color: 'rgba(249, 115, 22, 0.07)' },
        ];

        const releaseBandsPlugin = {
            id: 'releaseBands',
            beforeDraw(chart) {
                const { ctx, chartArea, scales } = chart;
                if (!chartArea) return;
                const xScale = scales.x;

                RELEASES.forEach((release, i) => {
                    const x1 = xScale.getPixelForValue(new Date(release.date));
                    const x2 = i < RELEASES.length - 1
                        ? xScale.getPixelForValue(new Date(RELEASES[i + 1].date))
                        : chartArea.right;

                    const left = Math.max(x1, chartArea.left);
                    const right = Math.min(x2, chartArea.right);
                    if (left >= chartArea.right || right <= chartArea.left) return;

                    ctx.save();
                    // Band
                    ctx.fillStyle = release.color;
                    ctx.fillRect(left, chartArea.top, right - left, chartArea.bottom - chartArea.top);
                    // Dashed vertical line
                    ctx.strokeStyle = release.color.replace(/[\d.]+\)$/, '0.25)');
                    ctx.lineWidth = 1;
                    ctx.setLineDash([4, 4]);
                    ctx.beginPath();
                    ctx.moveTo(Math.max(x1, chartArea.left), chartArea.top);
                    ctx.lineTo(Math.max(x1, chartArea.left), chartArea.bottom);
                    ctx.stroke();
                    // Label at top
                    if (right - left > 35) {
                        ctx.fillStyle = '#9ca3af';
                        ctx.font = '9px -apple-system, BlinkMacSystemFont, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(release.label, (left + right) / 2, chartArea.top + 11);
                    }
                    ctx.restore();
                });
            }
        };

        // Fullscreen toggle
        document.getElementById('fullscreen-btn').addEventListener('click', () => {
            const el = document.getElementById('chart-section');
            if (!document.fullscreenElement) {
                const p = el.requestFullscreen ? el.requestFullscreen() : el.webkitRequestFullscreen ? el.webkitRequestFullscreen() : Promise.resolve();
                Promise.resolve(p).then(() => {
                    try { screen.orientation.lock('landscape'); } catch(e) {}
                });
            } else {
                document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen();
            }
        });

        async function loadData() {
            const resp = await fetch(CSV_URL);
            const text = await resp.text();
            return text.trim().split('\n').slice(1)
                .map(line => {
                    const [date, co, gen, tc] = line.split(',');
                    const coAuthored = parseInt(co, 10);
                    const generated = parseInt(gen, 10);
                    const total = parseInt(tc, 10);
                    const claude = Math.max(coAuthored, generated);
                    return { date, coAuthored, generated, claude, total, pct: total > 0 ? claude / total * 100 : 0 };
                })
                .filter(d => d.claude > 0);
        }

        function renderStats(data) {
            const last7 = data.slice(-7);
            const avgTotal = last7.reduce((s, d) => s + d.total, 0) / last7.length;
            const sumClaude = last7.reduce((s, d) => s + d.claude, 0);
            const sumTotal = last7.reduce((s, d) => s + d.total, 0);
            const pct7d = sumTotal > 0 ? sumClaude / sumTotal * 100 : 0;
            document.getElementById('stat-date').textContent = data[data.length - 1].date;
            document.getElementById('stat-commits').textContent = (avgTotal / 1000000).toFixed(1) + 'M';
            document.getElementById('stat-pct').textContent = pct7d.toFixed(1) + '%';
        }

        function renderChart(data) {
            document.getElementById('loading').style.display = 'none';
            const canvas = document.getElementById('chart');
            canvas.style.display = 'block';

            const showPoints = data.length <= 90;

            new Chart(canvas, {
                type: 'line',
                plugins: [releaseBandsPlugin],
                data: {
                    labels: data.map(d => d.date),
                    datasets: [
                        {
                            label: 'Total Commits',
                            data: data.map(d => d.total),
                            borderColor: '#6b7280',
                            backgroundColor: 'rgba(107, 114, 128, 0.06)',
                            fill: true,
                            yAxisID: 'y',
                            tension: reducedMotion ? 0 : 0.3,
                            pointRadius: showPoints ? 2.5 : 0,
                            pointHoverRadius: 4,
                            borderWidth: 1.5,
                        },
                        {
                            label: 'Claude Code Adoption',
                            data: data.map(d => d.pct),
                            borderColor: '#ea580c',
                            backgroundColor: 'transparent',
                            fill: false,
                            yAxisID: 'y1',
                            tension: reducedMotion ? 0 : 0.3,
                            pointRadius: showPoints ? 2.5 : 0,
                            pointHoverRadius: 4,
                            borderWidth: 2.5,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.2,
                    animation: reducedMotion ? false : { duration: 800 },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: data.length > 180 ? 'month' : 'week',
                                displayFormats: { week: 'MMM d', month: 'MMM yyyy' },
                                tooltipFormat: 'MMM d, yyyy',
                            },
                            grid: { display: false },
                            ticks: { color: '#9ca3af', font: { size: 11 } },
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Total Commits',
                                color: '#6b7280',
                                font: { size: 12, weight: '600' },
                            },
                            ticks: {
                                callback: v => (v / 1000000).toFixed(1) + 'M',
                                color: '#6b7280',
                                font: { size: 11 },
                            },
                            grid: { color: 'rgba(0,0,0,0.04)' },
                            beginAtZero: false,
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Claude Code Adoption',
                                color: '#ea580c',
                                font: { size: 12, weight: '600' },
                            },
                            ticks: {
                                callback: v => v.toFixed(1) + '%',
                                color: '#ea580c',
                                font: { size: 11 },
                            },
                            grid: { display: false },
                            beginAtZero: false,
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleFont: { size: 12 },
                            bodyFont: { size: 12 },
                            padding: 10,
                            cornerRadius: 6,
                            callbacks: {
                                label: function(ctx) {
                                    if (ctx.datasetIndex === 0) {
                                        return 'Total Commits: ' + ctx.raw.toLocaleString();
                                    }
                                    return 'Claude Code Adoption: ' + ctx.raw.toFixed(1) + '%';
                                },
                                afterBody: function(ctx) {
                                    const d = data[ctx[0].dataIndex];
                                    return 'Claude Commits: ' + d.claude.toLocaleString();
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            align: 'end',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'line',
                                padding: 16,
                                font: { size: 12 },
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData()
                .then(data => { renderStats(data); renderChart(data); })
                .catch(() => {
                    document.getElementById('loading').textContent = 'Error loading data.';
                });
        });
    </script>
</body>
</html>
